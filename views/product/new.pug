extends ../layout

block content 
    .container-fuid
        a(href="/products")
            button.btn.btn-info List  
        h2 Create new product
        .row
            .col-sm-6.form
                form(action='/products/create', method='POST', enctype="multipart/form-data")
                    label Title
                    input(type="text", name='title' required).form-control

                    label Description
                    textarea(name="description", cols="30", rows="4" required).form-control

                    label Price
                    input(type="text", name='price' required).form-control

                    label Discount
                    input(type="text", name='discount' ).form-control

                    label Brand
                    select(name='brand' required).custom-select
                        option(value='') Please Select
                        each item in brands
                            option(value=item.id)=item.name

                    label Category
                    select(name='category' required).custom-select
                        option(value='') Please Select
                        each item in categories
                            option(value=item.id)=item.name

                    .custom-file.my-2
                        //- AQUI TENGO LO DE LAS IMAGENES
                        input(type="file" id="customFile" name="image"  multiple="multiple" required).form-control
                        //- label(class="custom-file-label" for="customFile") Upload images

            .col-sm-6
                label Sizes
                .sizesWrapper
                        each item in sizes
                            .sizeBox
                                input(type="checkbox" name=item.number onclick=`handleCheckboxClick(event)` )
                                label(for=item.number)=item.number
                                input(type="number" id=item.number disabled placeholder="Quantity" ).quantity

        .row
            .col-sm-12
                input(type="hidden", name="sizes", id="arrSizeQuantity")

                input(type="submit" value="Create" class="button" onclick="handleCreate(event)").btn-info.btn.my-2

    script.

        let arrSizeQuantity = new Array();
        
        function initializeSizeForm(){
            let checkboxs =  document.getElementsByClassName('form-check-input');
            for(item of checkboxs){
                item.checked = false;
            }
            let quantityInputs = document.getElementsByClassName('quantity')
            for(item of quantityInputs){
                item.disabled = true;
                item.value = '';
            }
        }

        function handleCheckboxClick(event) {
            let inputQuantity = document.getElementById(event.target.name);

            if(event.target.checked){
                inputQuantity.disabled = false;

                let sizeQuantity = {};

                sizeQuantity.size = parseInt(inputQuantity.id);

                inputQuantity.addEventListener('input', () => {
                    sizeQuantity.quantity = parseInt(inputQuantity.value);
                });

                arrSizeQuantity.push(sizeQuantity);
            }else {
                inputQuantity.disabled = true;
                inputQuantity.value = inputQuantity.placeholder;    
            }
        }

        //- Paso el array al value del input tipo hidden al crear el prod.
        function handleCreate(event){
            document.getElementById('arrSizeQuantity').value = JSON.stringify(arrSizeQuantity);
        }

        //- Reseteo los checkbox al entrar:
        initializeSizeForm();